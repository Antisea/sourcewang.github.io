---
layout: post
title: IIC
---

i2c

## I2C总线特点
I2C总线最主要的优点是其简单性和有效性。  
由于接口直接在组件之上，因此I2C总线占用的空间非常小，减少了电路板的空间和芯片管脚的数量，降低了互联成本。  
总线的长度可高达25英尺，并且能够以10Kbps的最大传输速率支持40个组件。  
I2C总线的另一个优点是，它支持多主控(multimastering)， 其中任何能够进行发送和接收的设备都可以成为主总线。  
一个主控能够控制信号的传输和时钟频率。当然，在任何时间点上只能有一个主控。

## I2C总线工作原理
I2C总线上的数据稳定规则，SCL为高电平时SDA上的数据保持稳定，SCL为低电平时允许SDA变化。  
如果SCL处于高电平时，SDA上产生下降沿，则认为是起始位，SDA上的上升沿认为是停止位。  
通信速率分为常规模式(时钟频率100kHz)和快速模式(时钟频率400kHz)。  
同一总线上可以连接多个带有I2C接口的器件，每个器件都有一个唯一的地址，既可以是单接收的器件，也可以是能够接收发送的器件。
每次数据传输都是以一个起始位开始，而以停止位结束。传输的字节数没有限制。  
最高有效位将首先被传输，接收方收到第8位数据后会发出应答位。  
数据传输通常分为两种：主设备发送从设备接收和从设备发送主设备接收。这两种模式都需要主机发送起始位和停止位，应答位由接收方产生。  
从设备地址一般是1或2个字节，用于区分连接在同一I2C上的不同器件。
I2C总线在传送数据过程中共有三种类型信号， 它们分别是：开始信号、结束信号和应答信号。 
开始信号：SCL为高电平时，SDA由高电平向低电平跳变，开始传送数据。 
结束信号：SCL为低电平时，SDA由低电平向高电平跳变，结束传送数据。 
应答信号：接收数据的IC在接收到8bit数据后，向发送数据的IC发出特定的低电平脉冲，表示已收到数据。  
CPU向受控单元发出一个信号后，等待受控单元发出一个应答信号，CPU接收到应答信号后，根据实际情况作出是否继续传递信号的判断。  
若未收到应答信号，由判断为受控单元出现故障。
在I2C总线中只有主发送和主接收两种操作方式。  
> 在系统初始化时，由指令控制CPU送出相关的数据，经接口送到I2C寄存器内。
通过初始化这些寄存器，可以实现I2C总线的主模式控制，以及实现I2C总线上的从设备读写。
> 当主设备和其中的一个从设备交换数据时，主设备首先发出一个启动Start信号，这个信号被所有的从设备接收。
即从设备准备接收CPU的信号，然后主设备再发出它要通信的从设备地址。
接下来，所有的从设备将收到的这个地址和它们自己的地址进行比较。
> 如果收到的地址和它们自己的地址不同，则什么都不做，只是等待主设备发出停止stop信号；
如果收到的地址和它自己的地址相同，它就发出一个信号给主设备，这个信号称为应答**Acknowledge**信号。
当主设备收到应答信号后，它就开始向从设备发送数据或者从从设备接收数据。  
当所有操作都进行完毕时，主设备发出一个Stop信号，通信完毕，释放I2C总线；然后所有的从设备都等待下一次Start信号的到来。

## IIC总线基本操作
I2C规程运用主/从双向通讯。器件发送数据到总线上，则定义为发送器，器件接收数据则定义为接收器。  
主器件和从器件都可以工作于接收和发送状态。  
总线必须由主器件（通常为微控制器）控制，主器件产生串行时钟（SCL）控制总线的传输方向，并产生起始和停止条件。  
SDA线上的数据状态仅在SCL为低电平的期间才能改变，SCL为高电平的期间，SDA状态的改变被用来表示起始和停止条件。

[出自](http://www.doczj.com/doc/db8e8b37581b6bd97f19eaa6.html "doc之家")
